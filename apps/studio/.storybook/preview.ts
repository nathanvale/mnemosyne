import type { Preview } from '@storybook/nextjs-vite'

import { handlers } from '@studio/mocks'
import { initialize, mswLoader } from 'msw-storybook-addon'

// Initialize MSW
initialize(
  {
    onUnhandledRequest: ({ url, method }) => {
      console.error(`Unhandled ${method} request to ${url}.

        This exception has been only logged in the console, however, it's strongly recommended to resolve this error as you don't want unmocked data in Storybook stories.

        If you wish to mock an error response, please refer to this guide: https://mswjs.io/docs/recipes/mocking-error-responses
      `)
    },
    quiet: true,
  },
  handlers,
)

const preview: Preview = {
  loaders: [mswLoader],
  parameters: {
    controls: {
      matchers: {
        color: /(background|color)$/i,
        date: /Date$/i,
      },
    },

    a11y: {
      // 'todo' - show a11y violations in the test UI only
      // 'error' - fail CI on a11y violations
      // 'off' - skip a11y checks entirely
      test: 'todo',
    },
  },
}

export default preview
